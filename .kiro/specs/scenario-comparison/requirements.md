# 要件定義書

## はじめに

ライフプランシミュレーターに、複数のシナリオを同時に比較できる機能を追加します。この機能により、ユーザーは異なる投資戦略やライフプランの選択肢を数値的に比較検討し、より良い意思決定を行うことができます。

## 要件

### 要件1

**ユーザーストーリー:** 投資家として、保守的な投資戦略と積極的な投資戦略の結果を同時に比較したいので、リスクとリターンのトレードオフを理解して最適な戦略を選択できる

#### 受入基準

1. WHEN ユーザーが新しいシナリオを作成する THEN システムは現在の設定をベースとした新しいシナリオを作成する SHALL
2. WHEN ユーザーがシナリオに名前を付ける THEN システムはその名前でシナリオを保存し管理する SHALL
3. WHEN ユーザーが複数のシナリオを選択する THEN システムは最大5つまでのシナリオを同時比較対象として設定できる SHALL
4. WHEN ユーザーがシナリオの設定を変更する THEN システムは他のシナリオに影響を与えずに該当シナリオのみを更新する SHALL

### 要件2

**ユーザーストーリー:** ライフプランを検討する人として、複数のシナリオの結果を視覚的に比較したいので、各戦略の長期的な影響を直感的に理解できる

#### 受入基準

1. WHEN ユーザーが比較実行を選択する THEN システムは選択された全シナリオのシミュレーションを並行実行する SHALL
2. WHEN シミュレーションが完了する THEN システムは各シナリオの結果を異なる色で同一グラフ上に重ね合わせ表示する SHALL
3. WHEN ユーザーがグラフを確認する THEN システムは各シナリオの凡例を表示し、どの線がどのシナリオかを明確に識別できる SHALL
4. WHEN ユーザーが特定のシナリオにフォーカスする THEN システムは該当シナリオの線を強調表示し、他を薄く表示する SHALL

### 要件3

**ユーザーストーリー:** 意思決定者として、シナリオ間の具体的な数値差を確認したいので、重要な指標を数値で比較して客観的に判断できる

#### 受入基準

1. WHEN ユーザーが比較テーブルを表示する THEN システムは各シナリオの最終資産額、最大資産額、最小資産額を並べて表示する SHALL
2. WHEN ユーザーが年齢別比較を確認する THEN システムは指定した年齢での各シナリオの資産額を比較表示する SHALL
3. WHEN ユーザーがリスク指標を確認する THEN システムは各シナリオの資産枯渇確率、下位10%値を比較表示する SHALL
4. WHEN ユーザーが最良・最悪シナリオを確認する THEN システムは各指標で最も良い結果と最も悪い結果のシナリオをハイライト表示する SHALL

### 要件4

**ユーザーストーリー:** 効率的にシナリオを管理したい人として、シナリオ間の設定差分を明確に把握したいので、どのパラメータが結果の違いを生んでいるかを理解できる

#### 受入基準

1. WHEN ユーザーがシナリオ設定比較を表示する THEN システムは各シナリオ間で異なるパラメータのみをハイライト表示する SHALL
2. WHEN ユーザーが設定差分を確認する THEN システムは変更されたパラメータの値を並べて表示し、差分を数値で示す SHALL
3. WHEN ユーザーがベースシナリオを設定する THEN システムは他のシナリオとの差分をベースシナリオを基準として表示する SHALL
4. WHEN ユーザーがシナリオをコピーする THEN システムは既存シナリオの設定を複製して新しいシナリオを作成する SHALL

### 要件5

**ユーザーストーリー:** シナリオ分析を行う人として、比較結果をエクスポートしたいので、他の人と共有したり後で参照したりできる

#### 受入基準

1. WHEN ユーザーがエクスポートを選択する THEN システムは比較グラフを画像ファイル（PNG）として保存する SHALL
2. WHEN ユーザーがデータエクスポートを選択する THEN システムは比較テーブルのデータをCSV形式で出力する SHALL
3. WHEN ユーザーがレポート生成を選択する THEN システムは各シナリオの概要と主要指標をまとめたPDFレポートを生成する SHALL
4. WHEN ユーザーがシナリオ設定を共有する THEN システムは選択したシナリオの設定をJSON形式でエクスポートする SHALL

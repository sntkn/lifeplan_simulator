# ライフプランシミュレーター

## 概要

年間の収入、支出を算出し、将来いくら手元に残るか計算するアプリです。
インフレ率、投資リターンも考慮し、モンテカルロ法とヒストリカル法の2つのシミュレーション手法を選択できます。

## シミュレーション手法

### モンテカルロ法

- 確率的シミュレーション（ランダム要素あり）
- 設定したリターンとリスクに基づく理論計算
- 多数回実行して統計的な分布を算出
- 将来の不確実性を数値化

### ヒストリカル法

- 過去30年データを使用（1994-2023年）
- 複数の開始年でシミュレーション実行
- 実際の市場変動パターンを再現
- 仮想通貨：2014年以前は株式リターンを適用
- **長期シミュレーション対応**：
  - 30年以内：実際の過去データをそのまま使用
  - 30年超〜100年：過去30年分のデータを循環使用
  - 100年超：現実的でないため制限

## 入力項目

### シミュレーション設定

- シミュレーション方法（モンテカルロ法 / ヒストリカル法）
- シミュレーション回数（モンテカルロ法のみ）
- 株式リターンの地域（ヒストリカル法のみ）：S&P500、日経平均、世界株式
- インフレ率の地域（ヒストリカル法のみ）：日本、米国、世界

### 基本項目

- 初期年齢
- 終了年齢（最大120歳）
- インフレ率（モンテカルロ法のみ）
- 株式の期待リターン（年率）（モンテカルロ法のみ）
- 株式のリスク（標準偏差）（モンテカルロ法のみ）
- 仮想通貨の期待リターン（年率）（モンテカルロ法のみ）
- 仮想通貨のリスク（標準偏差）（モンテカルロ法のみ）
- 株売却時のコスト（税金等 0.1 = 10%の課税 *1）
- 仮想通貨売却時のコスト（税金等 0.3 = 30%の課税 *1）
- 現金保有の上限（万円）
- 現金保有の下限（万円）
- 仮想通貨保有の下限（万円）
- 株保有額の下限（万円）
- 現金不足時の優先取り崩し資産（仮想通貨 / 株式 / ランダム）
- 仕事をリタイアする年齢
- ローン年数
- 年間医療・介護費が発生する年齢
- 娯楽費が減少し始める年齢
- 娯楽費の年間減少率（0.1 = 10%減少）

*1 利益がどれくらいあるかわからないため、取り崩し額からざっくり税金を差し引きます

### 資産初期値（万円）

- 株保有額
- 仮想通貨保有額
- 現金

### 年間支出（万円）

- 生活費
- 娯楽費
- 住宅維持費
- 医療・介護費
- 住宅ローン

### 年間収入（万円）

- 給与所得
- 不動産所得

## 運用ルール

### 資産運用

- 株式と仮想通貨は設定されたリターンとリスクに基づいて変動
- 現金は投資リターンなし

### 収支計算

- 収入の合計から支出の合計を引き、現金に反映
- 収支がプラスの場合：現金が上限を上回ったら「現金不足時の優先取り崩し資産」設定に基づいて投資
- 収支がマイナスの場合：現金が下限を下回ったら資産を取り崩し

### 資産取り崩し・投資ルール

#### 現金上限超過時の投資

- 現金が上限を超えた場合、「現金不足時の優先取り崩し資産」設定に基づいて自動投資
- **仮想通貨優先**: 超過分を仮想通貨に投資
- **株式優先**: 超過分を株式に投資
- **ランダム**: 両方の資産が下限以上の場合はランダムに選択、そうでなければ適切な資産に投資

#### 現金不足時の取り崩し

1. 現金が下限を下回った場合、優先設定に従って取り崩し
   - **仮想通貨優先**: 仮想通貨→株式の順で取り崩し
   - **株式優先**: 株式→仮想通貨の順で取り崩し
   - **ランダム**: 両方の資産が下限以上の場合はランダムに優先順位を決定
2. 取り崩し時は設定された税率・手数料を考慮
3. 仮想通貨または株式が下限を下回った場合、もう一方から補填
4. 両方が下限を下回った場合、現金から補填（マイナス許容）

### 年齢による変化

- 設定年齢から娯楽費が設定された減少率で毎年削減
- 設定年齢から医療費・介護費が支出に加算
- リタイア年齢以降は給与所得が0になる

### インフレ調整

- 生活費、娯楽費、住宅維持費、医療・介護費、不動産所得にインフレ率を適用
- 株式・仮想通貨の価値もインフレの影響を受ける

### シミュレーション期間の制限

- **モンテカルロ法**：最大100年間（初期年齢から終了年齢まで）
- **ヒストリカル法**：最大100年間
  - 30年以内：過去の実データを使用
  - 30年超：過去30年分のデータを繰り返し使用（循環）
  - 例：50年間のシミュレーションでは、30年分のデータを1.67回繰り返す

## 機能

### 設定保存・読み込み

- シミュレーション設定を名前を付けて保存
- 保存した設定を読み込んで再利用
- 設定の削除機能

## 表示項目

### 結果テーブル

年齢ごとに以下の統計値を表示：

- 年齢
- 資産額中央値（50パーセンタイル）
- 上位10%（90パーセンタイル）
- 上位25%（75パーセンタイル）
- 下位25%（25パーセンタイル）
- 下位10%（10パーセンタイル）
- 株式中央値
- 仮想通貨中央値
- 現金中央値

### グラフ表示

- 縦軸：資産額（万円）
- 横軸：年齢
- 複数のパーセンタイル線を同時表示
- 資産構成（株式・仮想通貨・現金）の内訳表示

## 技術仕様

### 使用技術

- React + TypeScript
- Tailwind CSS
- Recharts（グラフ表示）

### データ

- 過去30年間の実際の市場データ（1994-2023年）
- S&P500、日経平均、世界株式のリターンデータ
- 日本、米国、世界のインフレ率データ
- 仮想通貨（Bitcoin）のリターンデータ
